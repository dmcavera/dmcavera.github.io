<!doctype html>
<html>
	<head>
		<meta charset="utf-8"/>
		<script src="wasm_exec.js"></script>
		<script>
			const go = new Go();
			WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject).then((result) => {
				go.run(result.instance);

				Init();
			});

			async function Init() {
				const params = new URLSearchParams(window.location.search);
				let startId = params.get('start');
				let endId = params.get('end');

				const response = await InitGo(startId, endId)
				if(startId != response.start || endId != response.end ) {
					startId = response.start;
					endId = response.end;
				}

				const start = await GetActor(startId)
					document.getElementById("startImg").src = start.image;
					document.getElementById("startLabel").innerHTML = start.name;
				
				const end = await GetActor(endId)
					document.getElementById("endImg").src = end.image;
					document.getElementById("endLabel").innerHTML = end.name;

				console.log(response);
			}
			
			async function SubmitGuess($this) {
				try {
					var guess = $this.previousElementSibling.value;
					const result = await Guess(guess)
					console.log(result)
					const card = ResultCard(result.image, result.name);

					// Insert the new item between the existing items
					let container = document.getElementById('guesses');
					var guessContainer = document.getElementById('guessContainer');
					var index = Array.prototype.indexOf.call(container.children, guessContainer);
					if (result.isInMovieWithStart) {
						container.insertBefore(card, container.childNodes[index]);
					} else if(result.isInMovieWithEnd) {
						container.appendChild(card);
					} else {
						alert(result.name+ " has not been in a movie with either.")
					}

					if(result.success) {
						container.removeChild(guessContainer)
						const guesses = container.children.length
						alert("Success in "+ guesses +" guesses")
					}
				} catch (err) {
					console.error('Caught exception', err)
				}
			}

			function ResultCard(imageUrl, labelText)  {
				// Create the container
				let container = document.createElement('div');
				container.className = 'image-container';

				// Create the image
				let image = document.createElement('img');
				image.id = 'endImg';
				image.src = imageUrl;
				image.alt = 'Image';

				// Create the label
				let label = document.createElement('div');
				label.id = 'endLabel';
				label.className = 'label';
				label.textContent = labelText;

				// Append the image to the container
				container.appendChild(image);

				// Append the label to the container
				container.appendChild(label);
				return container;
			}

			// Get the popup container
			const popupContainer = document.getElementById('popup-container');
			
			// Show the popup
			function showPopup() {
				popupContainer.style.display = 'flex';
			}
			
			// Hide the popup
			function hidePopup() {
				popupContainer.style.display = 'none';
			}
			
			// Add an event listener to the share button
			document.getElementById('share-btn').addEventListener('click', () => {
				// Your sharing logic goes here
				// For example, you can use the Web Share API
				navigator.share({
				title: 'Your title',
				text: 'Your text',
				url: 'https://example.com'
				})
				.then(() => {
					console.log('Shared successfully!');
				})
				.catch((error) => {
					console.error('Error sharing:', error);
				});
			});
		</script>
		<style>
			.box{
				display: flex;
				justify-content: center;
				align-items: center;
			}
			.image-container {
				text-align: center;
			}

			.image-container img {
				width: 200px; /* Adjust as needed */
				height: auto;
			}

			.label {
				margin-top: 10px; /* Adjust as needed */
			}

			p {
				width: 100%; /* Set the width of the container to the full width of the screen */
				white-space: normal; /* Allow the text to wrap to the next line when it reaches the edge of the screen */
				overflow-wrap: break-word; /* Add this to wrap the text at word boundaries */
			}

			#popup-container {
				position: fixed;
				top: 0;
				right: 0;
				bottom: 0;
				left: 0;
				background-color: rgba(0, 0, 0, 0.5);
				display: none;
				justify-content: center;
				align-items: center;
				flex-direction: column;
			}
			
			.popup-content {
				background-color: #fff;
				padding: 20px;
				border: 1px solid #ddd;
				border-radius: 10px;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
			}
			
			#share-btn {
				background-color: #4CAF50;
				color: #fff;
				padding: 10px 20px;
				border: none;
				border-radius: 5px;
				cursor: pointer;
			}
			
			#share-btn:hover {
				background-color: #3e8e41;
			}
		</style>
	</head>
	<body>
		<div id="popup-container" style="display: none;">
			<!-- The popup content -->
			<div class="popup-content">
			  <h2>Success!</h2>
			  <p>Your action was successful!</p>
			  <button id="share-btn">Share</button>
			</div>
		  </div>

		<h1 class="image-container">Degrees of Seperation</h1>
		<p class="image-container">Try to get from one actor to the other by entering actors they have worked with to find their degree of seperation. The lower the better.</p>
		<div class="image-container">
			<img  id='startImg' src="your-image-url.jpg" alt="Image">
			<div id='startLabel' class="label">Loading</div>
		  </div>
		
		<div id='guesses' class="image-container">
			<div id="guessContainer">
				<br/>
				<input id="guess" type="text"></textarea>
				<button onclick="SubmitGuess(this)">Submit</button>
				<br/>	
				<br/>	
			</div>
		</div>  

		  <div class="image-container">
			<img  id='endImg' src="your-image-url.jpg" alt="Image">
			<div id='endLabel' class="label">Loading</div>
		  </div>

		  <footer class="image-container">
			<p>Powered by</p>
			<img src="https://www.themoviedb.org/assets/2/v4/logos/v2/blue_long_2-9665a76b1ae401a510ec1e0ca40ddcb3b0cfe45f1d51b77a308fea0845885648.svg"/>
		  </footer>
	</body>
</html>